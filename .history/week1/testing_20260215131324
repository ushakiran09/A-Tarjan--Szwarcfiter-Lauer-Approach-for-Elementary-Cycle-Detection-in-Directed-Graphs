import unittest
import importlib.util
import sys
import os

# --- 1. FORCE LOAD THE FILE WITH A SPACE ---
file_name = "SL1.py"

# Double-check the file actually exists where the script is running
if not os.path.exists(file_name):
    print(f"Error: Could not find '{file_name}'.")
    print(f"Current working folder is: {os.getcwd()}")
    sys.exit(1)

# This is the advanced way to load a file with spaces in the name
spec = importlib.util.spec_from_file_location("sl_module", file_name)
sl_module = importlib.util.module_from_spec(spec)
spec.loader.exec_module(sl_module)

# Grab your class from the loaded file
SzwarcfiterLauer = sl_module.SzwarcfiterLauer


# --- 2. THE TEST ---
class TestCycleDetection(unittest.TestCase):

    def normalize_cycle(self, cycle):
        """Standardizes a cycle so it can be compared regardless of rotation."""
        if not cycle: return tuple()
        path = cycle[:-1]
        min_node = min(path)
        min_index = path.index(min_node)
        return tuple(path[min_index:] + path[:min_index])

    def test_cycles_ignore_order(self):
        
        # NOTE: You MUST define the graph here because Python ignores 
        # everything inside the 'if __name__ == "__main__":' block of SL 1.py
        input_graph = {
            "1": ["2", "3"],
            "2": ["1", "3"],
            "3": ["4", "1"],
            "4": ["5", "6", "3"],
            "5": ["4", "6"],
            "6": ["3", "4", "5"]
        }

        # Paste your expected cycles here
        expected_cycles = [
            ['1', '2', '1'],
            ['3', '1', '3'],
            ['2', '3', '1', '2'],
            ['3', '4', '3'],
            ['5', '4', '5'],
            ['6', '4', '6'],
            ['5', '6', '5'],
            ['3', '4', '5', '6', '3'],
            ['3', '4', '6', '3'],
            ['4', '5', '6', '4'],
            ['4','6','5','4']
        ]

        # Run the algorithm
        detector = SzwarcfiterLauer(input_graph)
        actual_cycles = detector.run()

        # Compare
        expected_set = set(self.normalize_cycle(c) for c in expected_cycles)
        actual_set = set(self.normalize_cycle(c) for c in actual_cycles)

        missing = expected_set - actual_set
        extra = actual_set - expected_set

        error_msg = ""
        if missing:
            error_msg += f"\n\n[MISSING] The code failed to find these cycles:\n{missing}"
        if extra:
            error_msg += f"\n\n[EXTRA] The code found these extra cycles you didn't expect:\n{extra}"

        self.assertTrue(len(missing) == 0 and len(extra) == 0, error_msg)

if __name__ == "__main__":
    unittest.main(verbosity=2)